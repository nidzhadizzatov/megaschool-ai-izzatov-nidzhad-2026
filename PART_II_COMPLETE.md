# Part II Implementation - Complete ‚úÖ

## –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. PR Webhook Handler (server.py)
- ‚úÖ –ù–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è `pull_request` events
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ–±—ã—Ç–∏–π: `opened`, `synchronize`, `reopened`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ PR –≤ –ë–î –¥–ª—è review
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ PR

### 2. Database Extension (database.py)
- ‚úÖ –ù–æ–≤—ã–π enum: `PRReviewStatus` (pending, reviewing, approved, rejected, failed)
- ‚úÖ –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞: `pr_reviews` (–æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç issues)
- ‚úÖ –ú–µ—Ç–æ–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è PR reviews:
  - `add_pr_review()` - –¥–æ–±–∞–≤–∏—Ç—å PR –≤ –æ—á–µ—Ä–µ–¥—å
  - `get_pending_pr_reviews()` - –ø–æ–ª—É—á–∏—Ç—å pending PR
  - `set_pr_reviewing()` - –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ
  - `set_pr_review_completed()` - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
  - `set_pr_review_failed()` - –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ failed
  - `increment_pr_review_attempts()` - —Å—á—ë—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–≤–∫–ª—é—á–∞—è PR reviews)

### 3. PR Review Worker (pr_review_worker.py) - –ù–û–í–´–ô –§–ê–ô–õ
- ‚úÖ –û—Ç–¥–µ–ª—å–Ω—ã–π worker –¥–ª—è review PR (–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å issue worker)
- ‚úÖ –û–ø—Ä–æ—Å –ë–î –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ (`WORKER_INTERVAL`)
- ‚úÖ Graceful shutdown (SIGINT, SIGTERM)
- ‚úÖ –õ–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫ (`MAX_ATTEMPTS`)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ retry –ª–æ–≥–∏–∫–∞
- ‚úÖ –í—ã–∑–æ–≤ `review_pr_files()` –∏–∑ pr_reviewer.py

### 4. PR Reviewer (pr_reviewer.py) - –ü–û–õ–ù–ê–Ø –ü–ï–†–ï–†–ê–ë–û–¢–ö–ê
- ‚úÖ –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è: `review_file_for_issue()` - review –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
- ‚úÖ **–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞**: `{ issue_solved: boolean, notes: string }` (–∫–∞–∫ —Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å!)
- ‚úÖ Review **–¢–û–õ–¨–ö–û –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤** (—ç–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤!)
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏–∑ PR —á–µ—Ä–µ–∑ GitHub API
- ‚úÖ –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è —Å–æ –≤—Å–µ–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –≤ PR
- ‚úÖ JSON parsing —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
- ‚úÖ –°—Ç–∞—Ç—É—Å: ‚úÖ PASSED –∏–ª–∏ ‚ùå NEEDS WORK –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞

### 5. CLI Extension (cli.py)
- ‚úÖ –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞: `start-pr-worker` - –∑–∞–ø—É—Å–∫ PR review worker
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞: `run` - –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ 3 —Å–µ—Ä–≤–∏—Å–∞:
  - Webhook server
  - Issue solver worker
  - **PR review worker** (–Ω–æ–≤—ã–π!)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

### 6. Docker & Supervisor (–∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫)
- ‚úÖ **supervisord.conf** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è 3 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:
  - `webhook_server` - FastAPI —Å–µ—Ä–≤–µ—Ä
  - `issue_worker` - Issue solver
  - `pr_review_worker` - PR reviewer
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ (`autorestart=true`)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `/var/log/supervisor/`
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω Dockerfile:
  - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ supervisor
  - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ curl (–¥–ª—è healthcheck)
  - CMD –∑–∞–ø—É—Å–∫–∞–µ—Ç supervisord
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω docker-compose.yml:
  - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è PR review worker
  - Healthcheck endpoint
  - Persistent volumes –¥–ª—è –ë–î –∏ repos
  - restart: unless-stopped

### 7. Documentation
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω README.md:
  - –û–ø–∏—Å–∞–Ω–∏–µ Part I –∏ Part II
  - –î–∏–∞–≥—Ä–∞–º–º—ã workflow
  - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ GitHub App
  - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ù–æ–≤—ã–π —Ñ–∞–π–ª: DEPLOY.md:
  - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é –Ω–∞ VPS
  - –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
  - Troubleshooting
  - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤

## –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Part II

### üéØ –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
- Review **–¢–û–õ–¨–ö–û** –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (–Ω–µ –≤–µ—Å—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π!)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –∏–∑ PR webhook –∏–ª–∏ GitHub API
- –ò–∑–±–µ–≥–∞–µ–º –ª–∏—à–Ω–∏—Ö LLM –∑–∞–ø—Ä–æ—Å–æ–≤

### üìä –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (–∫–∞–∫ —Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å)
```json
{
  "issue_solved": true/false,
  "notes": "–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –∏–ª–∏ —É—Å–ø–µ—Ö–æ–≤"
}
```

### üîÑ –ê–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
- Supervisor —Å–ª–µ–¥–∏—Ç –∑–∞ 3 –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏
- –ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –ª—é–±–æ–≥–æ - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π restart
- –õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞

### üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 2 workers (issues + PR reviews)
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ–ø—Ä–æ—Å–∞ (`WORKER_INTERVAL`)
- –õ–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç End-to-End

1. **–°–æ–∑–¥–∞—ë—Ç—Å—è Issue** ‚Üí webhook ‚Üí –ë–î (table: issues, status: pending)
2. **Issue Worker** (–∫–∞–∂–¥—ã–µ 5—Å) ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç ‚Üí —Å–æ–∑–¥–∞—ë—Ç PR
3. **PR —Å–æ–∑–¥–∞–Ω** ‚Üí webhook ‚Üí –ë–î (table: pr_reviews, status: pending)
4. **PR Review Worker** (–∫–∞–∂–¥—ã–µ 5—Å) ‚Üí review–∏—Ç –¢–û–õ–¨–ö–û –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
5. **–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞**: `{ issue_solved: bool, notes: string }`
6. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ GitHub** —Å–æ –≤—Å–µ–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏:
   - ‚úÖ PASSED: —Ñ–∞–π–ª OK
   - ‚ùå NEEDS WORK: –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
7. **–°—Ç–∞—Ç—É—Å –≤ –ë–î**: approved (–≤—Å–µ OK) –∏–ª–∏ rejected (–µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã)

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–≤–∞–∂–Ω—ã–µ –¥–ª—è Part II)

```bash
# –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–±–æ–∏—Ö workers
WORKER_INTERVAL=5           # –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–ø—Ä–æ—Å–∞ (—Å–µ–∫—É–Ω–¥—ã)
MAX_ATTEMPTS=3              # –õ–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ issue/PR
MAX_FIX_ITERATIONS=3        # –õ–∏–º–∏—Ç —Ü–∏–∫–ª–æ–≤ fix-analyze –Ω–∞ —Ñ–∞–π–ª

# GitHub (–Ω—É–∂–Ω—ã –¥–ª—è PR review)
GITHUB_TOKEN=ghp_xxx        # –î–ª—è —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏–∑ PR
GITHUB_REPO=owner/repo      # –¶–µ–ª–µ–≤–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
```

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) - –≤—Å—ë –≤–º–µ—Å—Ç–µ
docker-compose up -d

# –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω–æ - –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
python cli.py run

# –í–∞—Ä–∏–∞–Ω—Ç 3: –û—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
python cli.py start-server       # Terminal 1
python cli.py start-worker       # Terminal 2
python cli.py start-pr-worker    # Terminal 3
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# 1. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
curl http://localhost:8000/
# –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å: pending_issues, pr_pending, pr_approved, etc.

# 2. –°–ø–∏—Å–æ–∫ issues –∏ PR reviews
python cli.py list-issues

# 3. –õ–æ–≥–∏ (Docker)
docker-compose logs -f coding_agent

# 4. –õ–æ–≥–∏ (Supervisor)
docker-compose exec coding_agent tail -f /var/log/supervisor/pr_review_worker.out.log
```

## –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –¥–µ–ø–ª–æ—è

1. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env (–≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã)
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å GitHub App (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤ README.md)
3. ‚úÖ –ü–æ–ª—É—á–∏—Ç—å GitHub Token (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤ README.md)
4. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Webhook URL –≤ GitHub App
5. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ VPS (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤ DEPLOY.md)

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –°–æ–∑–¥–∞–π—Ç–µ Issue –≤ –≤–∞—à–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
2. –ß–µ—Ä–µ–∑ ~5-15 —Å–µ–∫—É–Ω–¥ –ø–æ—è–≤–∏—Ç—Å—è PR
3. PR –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑–æ–≤–µ—Ç PR review
4. –ß–µ—Ä–µ–∑ ~5-10 —Å–µ–∫—É–Ω–¥ –≤ PR –ø–æ—è–≤–∏—Ç—Å—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ review
5. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø–æ–∫–∞–∂–µ—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞: issue_solved + notes

## –§–∞–π–ª—ã Part II

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- `agent/pr_review_worker.py` - Worker –¥–ª—è PR reviews
- `agent/supervisord.conf` - Supervisor config
- `DEPLOY.md` - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `agent/server.py` - –¥–æ–±–∞–≤–ª–µ–Ω PR webhook handler
- `agent/database.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã PR review –º–µ—Ç–æ–¥—ã
- `agent/pr_reviewer.py` - –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞
- `agent/cli.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ start-pr-worker
- `agent/Dockerfile` - supervisor + curl
- `docker-compose.yml` - –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, healthcheck
- `README.md` - –æ–ø–∏—Å–∞–Ω–∏–µ Part II
- `.env` - –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

## –°—Ç–∞—Ç—É—Å: –ì–û–¢–û–í–û ‚úÖ

Part II –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω (—Å–∏–Ω—Ç–∞–∫—Å–∏—Å –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ OK).

–û—Å—Ç–∞–ª–æ—Å—å:
1. –ü–æ–ª—É—á–∏—Ç—å GITHUB_TOKEN (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤ README.md)
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Webhook –≤ GitHub App
3. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ VPS (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤ DEPLOY.md)

üöÄ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∑–∞–ø—É—Å–∫—É!
